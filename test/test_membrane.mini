# Test: Test membrane reactions

import default_logging.ini
import default_time_stepping.ini

__name = test_membrane
_F = 0.029
_k = 0.057

[grid]
dimension = 2
file = grids/test_cell.msh
initial_level = 0

[model]
order = 1

[model.time_stepping]
begin = 0.
end = 0.01
step = 2e-3
initial_step = 2e-3
min_step = 1e-3
max_step = 2e-3
decrease_factor = 0.9
increase_factor = 1.1

[model.compartments]
cell    = 0
nucleus = 1

[model.writer]
file_path = {__name}

############################ Model for cell ############################
[model.cell.initial]
[model.cell.reaction]
[model.cell.reaction.jacobian]
[model.cell.diffusion]
[model.cell.boundary.nucleus.outflow]
[model.cell.boundary.nucleus.outflow.jacobian]

# membrane species

[model.cell.boundary.nucleus.initial]
u = 10
v = 10

[model.cell.boundary.nucleus.reaction]
u = -u*v^2 + {_F}*(1-u)
v = u*v^2 - {_F}*(1-{_k})*v

[model.cell.boundary.nucleus.reaction.jacobian]
du__du = -v^2 - {_F}
du__dv = -2*u*v
dv__dv = 2*u*v - {_F}*(1-{_k})
dv__du = v^2

[model.cell.boundary.nucleus.diffusion]
u = 1e-5
v = 0.4*1e-5

# membrane boundary species

[model.cell.boundary.cell.initial]
b = 10

[model.cell.boundary.cell.reaction]
b = 100

[model.cell.boundary.cell.reaction.jacobian]
db__db= 0

[model.cell.boundary.cell.diffusion]
b = 1


############################ Model for nucleus ############################
[model.nucleus.initial]
[model.nucleus.reaction]
[model.nucleus.reaction.jacobian]
[model.nucleus.diffusion]
[model.nucleus.boundary.cell.outflow]
[model.nucleus.boundary.cell.outflow.jacobian]
######################### Compare with reference vtk #########################
[wrapper.vtkcompare]
name = {__name}/{__name}-cell-00005 {__name}/{__name}-nucleus-00005
reference = reference/cell-00005 reference/nucleus-00005
extension = vtu vtu
relative = 2e-12
absolute = 1e-12
