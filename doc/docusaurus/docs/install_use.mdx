---
id: install_use
title: Installation and Usage
sidebar_label: Install & Use
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Usage

There are three supported ways to use **dune-copasi**:

* [GUI: Graphical User Interface](#graphical-user-interface)
* [CLI: Command Line Interface](#command-line-interface)
* [API: Application Programming Interface](#application-programming-interface)

### Graphical User Interface

The [Spatial Model Editor](https://github.com/spatial-model-editor/spatial-model-editor)
is a **user friendly** GUI editor to create and edit 2D
spatial *Systems Biology Markup Language* ([SBML](https://en.wikipedia.org/wiki/SBML))
models of bio-chemical reactions. Additionally, it can run simulations with **dune-copasi**. A big
adventage of this package is that is tailored for biologists and is available
with just a pair of clicks on the major plataforms. Find more information
[here](https://spatial-model-editor.readthedocs.io/en/latest/quickstart/get-started.html)!

[![sme](./img/spatial-model-editor.png)](https://spatial-model-editor.readthedocs.io/en/latest/quickstart/get-started.html)

### Command Line Interface

In this form, we provided one executable named `dune-copasi` for running forward simulations.
This executable is completely configurable from the command line arguments passed to it.

```bash
dune-copasi --help
```

Find more information about available configurations on the
[Parameter Tree](param_tree) documentation. This form may be
installed in one of the following procedures:

* [Docker Container](#docker-container)
* [Manual Installation](#manual-installation)

### Application Programming Interface

C++ objects may be consumed by other programs in order
to generate custom simulation rules, to couple intermediate steps with other
tools, to implement another GUI, etc. In such a case, **dune-copasi** must be
available in development mode and the downstream library is expected to
[consume the library](#importing-cmake-targets) by using the
[CMake build system](https://cmake.org) and use the [C++ objects](pathname://./doxygen/index.html) in code.
This form is available on:

* [Manual Installation](#manual-installation)
* [Docker Build](#docker-build)

#### Doxygen Documentation

The C++ classes are documented directly in the source code and may be visualized with
[Doxygen](https://www.doxygen.nl/index.html). To locally have the doxygen html
documentation, build **dune-copasi** [manually](#manual-installation) and use the
`make dune-copasi-doc` target in the build directory. For this, you need to
have `doxygen` on your system.

* [Online Doxygen Documentation](pathname://./doxygen/index.html)


## Installation

### Graphical User Interface

To install the Spatial Model Editor, please refer to its installation
instructions:

* https://spatial-model-editor.readthedocs.io/en/stable/quickstart/get-started.html#installation

### Docker Container

The easiest form to use our executables for CLI usage, is by using a
[Docker Container](https://www.docker.com/). There, the software is boundled
such that no installation other than docker is required.

#### Install Docker
First, get and install Docker following the
[docker installation instructions](https://docs.docker.com/get-docker/).

#### Prepare a working directory

To be able to easily share data between your operating system and the docker
container, prepare a working directory with read/write rights to _other users_
(e.g. a folder named `dune-copasi`):

```bash
mkdir -m o+rw dune-copasi && cd dune-copasi
```

This working directory will be accessible to your text editor, paraview as
well as to the CLI executable inside the docker container. Thus,
move or create your configuration files into it at will.

```ini
# setup/write ini and input files for dune-copasi, for example...
echo """
grid.dimension = 2
compartments.domain.expression = 1
model.scalar_field.u.reaction.expression = 1+2*u
model.scalar_field.u.reaction.jacobian.u.expression = 2
model.scalar_field.u.storage.expression = 1
""" >> exp.ini
```

#### Run the program

Here, you may pull and run the latest stable container from our
[GitLab Registry](https://gitlab.dune-project.org/copasi/dune-copasi/container_registry).
To do so, call the docker container with a configuration
file `config.ini` using one of the following commands on the terminal:

```bash
docker run -v $PWD \
  registry.dune-project.org/copasi/dune-copasi/dune-copasi:latest\
  --config=exp.ini
```

The results of those computations will be written on current
directory as mentioned above. For more information about running docker images,
visit the [`docker run` documentation](https://docs.docker.com/engine/reference/run/).

### Docker Build

Advanced users, who may want to make modifications the **dune-copasi**
code but do not to install all the dependencies may opt for a docker build. In
this case, you must download the **dune-copasi** source code, modify it, and build
a new local docker image:

```bash
# fetch source code from git
git clone https://gitlab.dune-project.org/copasi/dune-copasi

# enter dune-copasi directory
cd dune-copasi

# checkout the branch you want to modify (e.g. latest)
git checkout latest

# modify source code at will...
touch src/dune_copasi.cc

# build a new docker image from modified code (tag: dune-copasi)
docker build -t my-dune-copasi .
```

This will build all dune dependencies as well as the new modified version of
**dune-copasi**. Then, follow the [Docker runner guide](#docker-container) to run
the new image with tag `dune-copasi`.

### Manual Installation

Finally, to locally build and install **dune-copasi** we requires to obtain, compile
and install a variety of dependencies.

#### Operating Systems and Compilers

The manual installation is known to compile and run under Debian/Ubuntu, macOS, and Windows.
In all three cases with [Clang](https://clang.llvm.org) and [GCC](https://gcc.gnu.org)
based compilers. It is however, known to not be compatible with Microsoft Visual Studio.


#### Dependencies

The following list of software is required to install and use **dune-copasi**:

| Software | Version/Branch |
| ---------| -------------- |
| [CMake](https://cmake.org/)                                                                 | >= 3.1 |
| C++ compiler  | >= [C++20](https://en.wikipedia.org/wiki/List_of_compilers#C++_compilers) |
| [libTIFF](http://www.libtiff.org/)                                                          | >= 3.6.1 |
| [muParser](https://beltoforion.de/article.php?a=muparser)                                   | >= 2.2.5 |
| [SymEngine](https://github.com/symengine/symengine)                                         | >= 0.8.0 |
| [ExprTk](https://github.com/ArashPartow/exprtk)                                             | >= 0.0.2 |
| [ParaFields](https://parafields.readthedocs.io/)                                            | `61b2893` |
| [dune-common](https://gitlab.dune-project.org/copasi/dune-common)                           | `master` |
| [dune-geometry](https://gitlab.dune-project.org/core/dune-geometry)                         | `master` |
| [dune-grid](https://gitlab.dune-project.org/core/dune-grid)                                 | `master` |
| [dune-uggrid](https://gitlab.dune-project.org/staging/dune-uggrid)                          | `master` |
| [dune-istl](https://gitlab.dune-project.org/core/dune-istl)                                 | `master` |
| [dune-localfunctions](https://gitlab.dune-project.org/core/dune-localfunctions)             | `master` |
| [dune-functions](https://gitlab.dune-project.org/staging/dune-functions)                    | `master` |
| [dune-multidomaingrid](https://gitlab.dune-project.org/extensions/dune-multidomaingrid)     | `master` |
| [dune-typetree](https://gitlab.dune-project.org/staging/dune-typetree)                      | `master` |
| [dune-pdelab](https://gitlab.dune-project.org/pdelab/dune-pdelab)                           | `feature/dune-assembler/main` |

:::info
Some packages require rather new features so they need to be from specific brances/commits.
:::

#### Dune Options File

An important part of the installation procedure is to tune the build system
flags to accommodate the build to your system. This is done via the [dune options
file](https://dune-project.org/doc/installation/#storing-flags-in-an-options-file).
In essence, is just a bash script that sets different flags (mainly the flags
for CMake `CMAKE_FLAGS`). While the dune project usually leaves this open for the user, we
provide a `dune-copasi.opts` file with sensible default options for the main
operating systems.

This file can be called to show the current configuration:

```bash
./dune-copasi.opts
```

There are two forms to add flags to the `dune-copasi.opts` file:

1. Setting environmental variables starging with `CMAKE_` and `DUNE_`.
   These variables will be automatically included into the list of cmake flags.

  ```bash
  export CMAKE_INSTALL_PREFIX="/path/to/install/prefix/"
  export CMAKE_GENERATOR="'Ninja'"
  ./dune-copasi.opts
  ```

2. Appending new flags into the `CMAKE_FLAGS` variable in the `dune-copasi.opts` file
  (care must be taken to scape quotes):

  ```bash
  echo 'CMAKE_FLAGS+=" -DCMAKE_INSTALL_PREFIX=/path/to/install/prefix/"' >> dune-copasi.opts
  echo "CMAKE_FLAGS+=\" -DCMAKE_GENERATOR='Ninja'\"" >> dune-copasi.opts
  ./dune-copasi.opts
  ```

For more information about the possible options and the dune options file, check out
the dune [installation documentation](https://dune-project.org/doc/installation/)
and the [build system documentation](https://dune-project.org/sphinx/core-2.7/).

#### Installation

The first four dependencies can be obtained by your preferred package manager in
unix-like operating systems. e.g.

<Tabs
  groupId="package-manager"
  defaultValue="apt"
  values={[
      {label: 'Debian/Ubuntu (apt)', value: 'apt', },
      {label: 'macOS/Linux (brew)', value: 'brew', },
    ]
  }>

  <TabItem value="apt">

```bash
apt update
apt install cmake gcc g++ libtiff-dev libmuparser-dev git
```

  </TabItem>
  <TabItem value="brew">

```bash
brew update
brew install cmake gcc libtiff muparser git
```

  </TabItem>
</Tabs>

The required `DUNE` modules (including **dune-copasi**) can be obtained via
internet by using [`git`](https://git-scm.com/). For smooth installation, is
better place all the dune modules within the same directory.

:::caution DUNE Version incompatibility
Notice that this procedure assumest that you don't have previous installation of DUNE in
your system. If that's the case, uninstall DUNE before continouing, otherwise, version
conflicts may be difficult if not impossible to resolve.
:::

```bash
# prepare a folder to download and build dune modules
mkdir /tmp/dune-modules && cd /tmp/dune-modules

# fetch dependencies & dune-copasi in ~/dune-modules folder
git clone https://gitlab.dune-project.org/core/dune-common
git clone https://gitlab.dune-project.org/core/dune-geometry
git clone https://gitlab.dune-project.org/core/dune-grid
git clone https://gitlab.dune-project.org/staging/dune-uggrid
git clone https://gitlab.dune-project.org/core/dune-istl
git clone https://gitlab.dune-project.org/core/dune-localfunctions
git clone https://gitlab.dune-project.org/staging/dune-functions
git clone https://gitlab.dune-project.org/extensions/dune-multidomaingrid
git clone https://gitlab.dune-project.org/copasi/dune-typetree
git clone -b feature/dune-assembler/main https://gitlab.dune-project.org/copasi/dune-pdelab
git clone  https://gitlab.dune-project.org/copasi/dune-copasi
```

Then, build and install the `DUNE` modules with the `dunecontrol` script:

```bash
# choose an installation path (this is read by the 'dune-copasi.opts' file)
export CMAKE_INSTALL_PREFIX=/opt/dune/

# configure and build dune modules (go grab a coffee)
./dune-common/bin/dunecontrol --opts=dune-copasi/dune-copasi.opts all

# install binaries and libraries (may require sudo)
./dune-common/bin/dunecontrol --opts=dune-copasi/dune-copasi.opts bexec make install

# remove source and build files
cd $HOME && rm -r /tmp/dune-modules

# include dune binaries into your path
echo "export PATH=${CMAKE_INSTALL_PREFIX}/bin:\$PATH" >> $HOME/.bashrc
```

For further information on dune module installation process, please check out
the [dune-project web page](https://www.dune-project.org/doc/installation/).

#### Run the program

Once installed, the program `dune-copasi` will be available on the command line:

```bash
dune-copasi --help
```

#### Importing CMake targets

If you additionally want to use the [API](#application-programming-interface) for
development, you must find and consume the CMake targets from `dune-copasi`
in your project as follows:

```
# ...
find_package(dune-copasi IMPORTED REQUIRED)
target_link_libraries(my_app PRIVATE Dune::Copasi)
# ...
```

If `dune-copasi` was installed on a custom directory
(e.g. using `CMAKE_INSTALL_PREFIX=/opt/dune`), it may be possible that you need to
pass such directory to the `CMAKE_PREFIX_PATH` when building the project. This way,
CMake can find our targets and configuration:

```bash
cmake -DCMAKE_PREFIX_PATH:PATH=/opt/dune /path/to/app/source/
```
